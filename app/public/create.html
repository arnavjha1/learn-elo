<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Serene Fields Wiki - Create a Post</title>
    <style>
      body {
        margin: 0;
        font-family: "Arial", sans-serif;
        background-color: #1e1e1e;
        color: #f4f4f4;
      }

      nav {
        background-color: #333;
        padding: 15px 20px;
        margin-bottom: 20px;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      nav ul {
        list-style: none;
        padding: 0;
        margin: 0;
        display: flex;
      }

      nav ul li {
        margin: 0 15px;
      }

      nav ul li a {
        text-decoration: none;
        color: #f4f4f4;
        font-weight: bold;
        font-size: 1.1em;
        background-color: #555;
        padding: 10px 20px;
        border-radius: 25px;
        transition: background-color 0.3s ease, color 0.3s ease;
        margin-bottom: 10px;
      }

      nav ul li a:hover {
        background-color: #ff6600;
        color: #fff;
      }

      nav .search-container {
        margin-left: auto;
      }

      nav .search-container input[type="text"] {
        padding: 8px 15px;
        border-radius: 25px;
        border: none;
        outline: none;
        font-size: 1em;
      }

      main {
        padding: 20px;
      }

      h2 {
        font-size: 2em;
        border-bottom: 2px solid #ff6600;
        padding-bottom: 10px;
        margin-bottom: 20px;
      }

      body {
        margin: 0;
        font-family: "Arial", sans-serif;
        background-color: #1e1e1e;
        color: #f4f4f4;
      }

      nav {
        background-color: #333;
        padding: 15px 20px;
        margin-bottom: 20px;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      nav ul {
        list-style: none;
        padding: 0;
        margin: 0;
        display: flex;
      }

      nav ul li {
        margin: 0 15px;
      }

      nav ul li a {
        text-decoration: none;
        color: #f4f4f4;
        font-weight: bold;
        font-size: 1.1em;
        background-color: #555;
        padding: 10px 20px;
        border-radius: 25px;
        transition: background-color 0.3s ease, color 0.3s ease;
        margin-bottom: 10px;
      }

      a {
        color: #ff6600;
        text-decoration: none;
        font-weight: bold;
      }

      a:hover {
        color: #ffa04c;
      }

      nav ul li a:hover {
        background-color: #ff6600;
        color: #fff;
      }

      nav .search-container {
        margin-left: auto;
      }

      nav .search-container input[type="text"] {
        padding: 8px 15px;
        border-radius: 25px;
        border: none;
        outline: none;
        font-size: 1em;
      }

      header {
        background-color: #444;
        padding: 20px;
        text-align: center;
        margin-top: 20px;
      }

      header .logo h1 {
        margin: 0;
        font-size: 2.5em;
        color: #ff6600;
      }
      .toolbar {
        display: flex;
        gap: 10px;
        margin-bottom: 20px;
      }

      .toolbar button {
        padding: 10px 15px;
        background-color: #555;
        color: #f4f4f4;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        transition: background-color 0.3s ease;
      }

      .toolbar button:hover {
        background-color: #ff6600;
      }

      .preview {
        background-color: #333;
        padding: 20px;
        border-radius: 10px;
        margin-bottom: 20px;
      }

      .preview * {
        margin: 10px 0;
      }

      form input[type="submit"] {
        background-color: #ff6600;
        color: #fff;
        border: none;
        padding: 10px 20px;
        border-radius: 25px;
        font-size: 1.1em;
        cursor: pointer;
        transition: background-color 0.3s ease, color 0.3s ease;
      }

      form input[type="submit"]:hover {
        background-color: #ffa04c;
      }

      footer {
        background-color: #333;
        text-align: center;
        padding: 15px;
        margin-top: 20px;
      }

      footer p {
        margin: 0;
        color: #ff6600;
      }

      .element-container {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 5px;
        border: 1px solid #444;
        border-radius: 5px;
        margin: 10px 0;
        background-color: #222;
      }

      .element-container .delete-btn {
        background-color: #ff6600;
        border: none;
        color: white;
        padding: 5px 10px;
        border-radius: 5px;
        cursor: pointer;
        transition: background-color 0.3s ease;
      }

      .element-container .delete-btn:hover {
        background-color: #ff3333;
      }
    </style>
  </head>

  <body>
    <nav>
      <ul>
        <li><a href="#overview">Home</a></li>
        <li><a href="#characters">Trending</a></li>
        <li><a href="#mechanics">Create</a></li>
      </ul>
      <div class="search-container">
        <input type="text" placeholder="Search..." />
      </div>
    </nav>

    <header>
      <div class="logo">
        <h1>Create A New Article</h1>
      </div>
    </header>

    <main>
      <h2 id="pTitle" contenteditable>(click to add title)</h2>
      <div class="toolbar">
        <button onclick="addElement('h1')">Add Heading</button>
        <button onclick="addElement('h2')">Add Subheading</button>
        <button onclick="addElement('p')">Add Paragraph</button>
        <button onclick="addElement('img')">Add Image</button>
        <button onclick="addElement('video')">Add Video</button>
        <button onclick="addElement('a')">Add Link</button>
        <button onclick="addElement('ul')">Add Unordered List</button>
        <button onclick="addElement('ol')">Add Ordered List</button>
        <button onclick="addElement('code')">Add Code</button>
        <button onclick="addElement('b')">Add Bold Text</button>
      </div>

      <div class="preview" id="live-preview"></div>

      <form onsubmit="showHTML(event)">
        <input type="submit" value="Submit Post" />
      </form>
    </main>

    <footer>
      <p>&copy; 2024 Serene Fields Wiki. All rights reserved.</p>
    </footer>

    <script>
      const name = document.cookie;
      const user = name.split("=")[1];
      let allData = [];
      const dreams = [];
      
      function getTime(){
        const d = new Date();
        let time = Date.UTC(d.getUTCFullYear(),d.getUTCMonth(),d.getUTCDay(),d.getUTCHours(),d.getUTCMinutes());
        return time;
      }

      fetch("/getDreams", {})
        .then((res) => res.json())
        .then((response) => {
          response.forEach((row) => {
            allData.push(row.dream);
          });
        });
      function valid(x) {
        return !(x == "" || x == " " || x.split(" ") != x);
      }
      function sqlAddItem(x) {
        const data = { dream: x };

        fetch("/addDream", {
          method: "POST",
          body: JSON.stringify(data),
          headers: { "Content-Type": "application/json" },
        })
          .then((res) => res.json())
          .then((response) => {
            console.log(JSON.stringify(response));
          });
        dreams.push(x);
        allData.push(x);
        // alert(allData);
      }
      function sqlRead(type, item, columns) {
        let results = [];
        for (let i = 0; i < allData.length; i++) {
          let k = allData[i].split(" ::: ");
          let col = [];
          let itemValid = false;
          if (k[0] == type && (k[1] == item || item == true)) {
            if (item == true) {
              for (let i = 1; i <= columns; i++) {
                col.push(k[i]);
                itemValid = true;
              }
            } else {
              for (let i = 2; i <= columns + 1; i++) {
                col.push(k[i]);
                itemValid = true;
              }
            }
          }
          if (itemValid) {
            results.push(col);
          }
        }
        return results;
      }

      const preview = document.getElementById("live-preview");

      function addElement(type) {
        let element = "";
        let container = document.createElement("div");
        container.className = "element-container";
        container.id = "planet";

        switch (type) {
          case "h1":
            element = "New Heading";
            if (element) {
              container.innerHTML = `<h2 contenteditable>${element}</h2>`;
            }
            break;
          case "h2":
            element = "New Subheading";
            if (element) {
              container.innerHTML = `<h3 contenteditable>${element}</h3>`;
            }
            break;
          case "p":
            element = "New Paragraph";
            if (element) {
              container.innerHTML = `<p contenteditable>${element}</p>`;
            }
            break;
          case "img":
            element = prompt("Enter the image URL:");
            if (element) {
              container.innerHTML = `<img src="${element}" alt="Image">`;
            }
            break;
          case "video":
            element = prompt("Enter the video URL:");
            if (element) {
              container.innerHTML = `<video controls><source src="${element}" type="video/mp4">Your browser does not support the video tag.</video>`;
            }
            break;
          case "a":
            element = prompt("Enter the URL:");
            const text = prompt("Enter the link text:");
            if (element && text) {
              container.innerHTML = `<a href="${element}" target="_blank">${text}</a>`;
            }
            break;
          case "ul":
            element = "Sample Item 1, Sample Item 2, Sample Item 3";
            if (element) {
              const items = element
                .split(",")
                .map((item) => `<li>${item.trim()}</li>`)
                .join("");
              container.innerHTML = `<ul contenteditable>${items}</ul>`;
            }
            break;
          case "ol":
            element = "Sample Item 1, Sample Item 2, Sample Item 3";
            if (element) {
              const items = element
                .split(",")
                .map((item) => `<li>${item.trim()}</li>`)
                .join("");
              container.innerHTML = `<ol contenteditable>${items}</ol>`;
            }
            break;
          case "code":
            element = "Sample code";
            if (element) {
              container.innerHTML = `<pre contenteditable><code>${element}</code></pre>`;
            }
            break;
          case "b":
            element = "New bold text";
            if (element) {
              container.innerHTML = `<b contenteditable>${element}</b>`;
            }
            break;
        }

        if (container.innerHTML) {
          const deleteBtn = document.createElement("button");
          deleteBtn.className = "delete-btn";
          deleteBtn.textContent = "Delete";
          deleteBtn.onclick = () => container.remove();

          container.appendChild(deleteBtn);
          preview.appendChild(container);
        }
      }

      function getCookie(cname) {
        let name = cname + "=";
        let decodedCookie = decodeURIComponent(document.cookie);
        let ca = decodedCookie.split(";");
        for (let i = 0; i < ca.length; i++) {
          let c = ca[i];
          while (c.charAt(0) == " ") {
            c = c.substring(1);
          }
          if (c.indexOf(name) == 0) {
            return c.substring(name.length, c.length);
          }
        }
        return "";
      }

      function showHTML(event) {
        event.preventDefault();
        let rawPreview = preview.innerHTML;
        rawPreview = rawPreview.split(' contenteditable=""');
        let semirawPreview = "";
        let halfrawpreview = "";
        let almostrawPreview = "";
        let preView = "";
        for (let i = 0; i < rawPreview.length; i++) {
          semirawPreview += rawPreview[i];
        }
        rawPreview = semirawPreview.split(
          '<button class="delete-btn">Delete</button>'
        );
        for (let i = 0; i < rawPreview.length; i++) {
          halfrawpreview += rawPreview[i];
        }
        rawPreview = halfrawpreview.split(
          '<div class="element-container" id="planet">'
        );
        for (let i = 0; i < rawPreview.length; i++) {
          almostrawPreview += rawPreview[i];
        }
        rawPreview = almostrawPreview.split("</div>");
        for (let i = 0; i < rawPreview.length; i++) {
          preView += rawPreview[i];
        }
        sqlAddItem(
          "post ::: " +
          (allData.length+Math.round(Math.random()*1000000000)) +
          " ::: " +
          getCookie("account") +
          " ::: " +
          getTime() +
          " ::: " +
          document.getElementById("pTitle").innerHTML +
          " ::: " +
          preView
        ); window.location = "/index.html";
      }
    </script>
  </body>
</html>